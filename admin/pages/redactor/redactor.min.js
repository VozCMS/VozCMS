var RTOOLBAR={};(function(c){jQuery.fn.redactor=function(d){return this.each(function(){var f=c(this);var e=f.data("redactor");if(!e){f.data("redactor",(e=new b(this,d)))}})};var b=function(e,d){this.$el=c(e);this.opts=c.extend({lang:"en",direction:"ltr",toolbar:"default",load:true,callback:false,keyupCallback:false,path:false,css:"style.css",focus:false,resize:true,autoresize:false,fixed:false,autoformat:true,cleanUp:true,convertDivs:true,removeClasses:true,removeStyles:false,convertLinks:true,handler:false,autosave:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,fileUpload:false,fileUploadCallback:false,visual:true,fullscreen:false,overlay:true,colors:Array("#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"),allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",modal:{}},d,this.$el.data());this.dropdowns=[];this.init()};b.prototype={_loadFile:function(d,g){var e=g[0];g.splice(0,1);var f;if(typeof(e)=="function"){f=e}else{f=c.proxy(function(){this._loadFile(e,g)},this)}this.dynamicallyLoad(d,f)},loadFiles:function(e){var d=e[0];e.splice(0,1);this._loadFile(d,e)},dynamicallyLoad:function(f,h){var g=document.getElementsByTagName("head")[0];var e=document.createElement("script");e.src=f;var d=false;e.onload=e.onreadystatechange=function(){if(!d&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){d=true;if(h){h()}e.onload=e.onreadystatechange=null}};g.appendChild(e)},init:function(){this.getPath();if(this.opts.load){var d=[];d.push(this.opts.path+"/langs/"+this.opts.lang+".js");if(this.opts.toolbar!==false){d.push(this.opts.path+"/toolbars/"+this.opts.toolbar+".js")}d.push(c.proxy(this.start,this));this.loadFiles(d)}else{this.start()}},start:function(){this.setupModalWindows();this.height=this.$el.css("height");this.width=this.$el.css("width");this.build();var d=this.$el.val();d=this.preformater(d);if(this.opts.autoformat){d=this.paragraphy(d)}this.$editor=this.enable(d);c(this.doc).click(c.proxy(function(f){this.$editor.focus()},this));c(this.doc).on("paste",c.proxy(function(f){setTimeout(c.proxy(function(){var e=Math.floor(Math.random()*99999);var h="";if(c.browser.mozilla){h="&nbsp;"}var g=c('<span rel="pastemarkerend" id="pastemarkerend'+e+'">'+h+"</span>");this.insertNodeAtCaret(g.get(0));this.pasteCleanUp(e)},this),200)},this));c(this.doc).keyup(c.proxy(function(g){var f=g.keyCode||g.which;if(typeof this.opts.keyupCallback=="function"){this.opts.keyupCallback(this,g)}if(this.opts.autoformat){if(f==8||f==46){return this.formatEmpty(g)}if(f==13&&!g.shiftKey&&!g.ctrlKey&&!g.metaKey){return this.formatNewLine(g)}}this.syncCode()},this));this.buildToolbar();if(this.opts.autoresize===false){this.buildResizer()}else{this.observeAutoResize()}this.shortcuts();this.autoSave();this.observeImages();if(this.opts.fullscreen){this.opts.fullscreen=false;this.fullscreen()}if(this.opts.focus){this.focus()}if(this.opts.fixed){this.observeScroll();c(document).scroll(c.proxy(this.observeScroll,this))}if(typeof this.opts.callback=="function"){this.opts.callback(this)}},shortcuts:function(){c(this.doc).keydown(c.proxy(function(f){var d=f.keyCode||f.which;if(f.ctrlKey){if(d==90){this._shortcuts(f,"undo")}else{if(d==90&&f.shiftKey){this._shortcuts(f,"redo")}else{if(d==77){this._shortcuts(f,"removeFormat")}else{if(d==66){this._shortcuts(f,"bold")}else{if(d==73){this._shortcuts(f,"italic")}else{if(d==74){this._shortcuts(f,"insertunorderedlist")}else{if(d==75){this._shortcuts(f,"insertorderedlist")}else{if(d==76){this._shortcuts(f,"superscript")}}}}}}}}}if(!f.shiftKey&&d==9){this._shortcuts(f,"indent")}else{if(f.shiftKey&&d==9){this._shortcuts(f,"outdent")}}if(c.browser.webkit&&navigator.userAgent.indexOf("Chrome")==-1){return this.safariShiftKeyEnter(f,d)}},this))},_shortcuts:function(f,d){if(f.preventDefault){f.preventDefault()}this.execCommand(d,null)},getPath:function(){if(this.opts.path!==false){return this.opts.path}c("script").each(c.proxy(function(d,e){if(e.src){var f=new RegExp(/\/redactor(\.min)?\.js(\?.*)?/);if(e.src.match(f)){this.opts.path=e.src.replace(f,"")}}},this))},build:function(){this.$box=c('<div class="redactor_box"></div>');this.$frame=c('<iframe frameborder="0" scrolling="auto" style="height: '+this.height+';" class="redactor_frame"></iframe>');this.$el.css("width","100%").hide();this.$box.insertAfter(this.$el).append(this.$frame).append(this.$el)},write:function(d){this.doc.open();this.doc.write(d);this.doc.close()},enable:function(d){this.doc=this.getDoc(this.$frame.get(0));if(this.doc!==null){this.write(this.setDoc(d));if(c.browser.mozilla){this.doc.execCommand("useCSS",false,true)}return c(this.doc).find("#page")}else{return false}},setDoc:function(e){var d="<!DOCTYPE html>\n";d+='<html><head><link media="all" type="text/css" href="'+this.opts.path+"/css/"+this.opts.css+'" rel="stylesheet"></head>';d+='<body><div id="page" contenteditable="true" dir="'+this.opts.direction+'">';d+=e;d+="</div></body></html>";return d},getDoc:function(d){if(d.contentDocument){return d.contentDocument}else{if(d.contentWindow&&d.contentWindow.document){return d.contentWindow.document}else{if(d.document){return d.document}else{return null}}}},focus:function(){this.$editor.focus()},syncCode:function(){var d=this.formating(this.$editor.html());this.$el.val(d)},setCode:function(d){d=this.preformater(d);this.$editor.html(d).focus();this.syncCode()},getCode:function(){var d=this.$editor?this.$editor.html():this.$el.val();d=this.reformater(d);return d},insertHtml:function(d){this.execCommand("inserthtml",d)},destroy:function(){var e=this.getCode();this.$box.after(this.$el);this.$box.remove();this.$el.val(e).show();for(var d=0;d<this.dropdowns.length;d++){this.dropdowns[d].remove();delete (this.dropdowns[d])}},handler:function(){c.ajax({url:this.opts.handler,type:"POST",data:"redactor="+escape(encodeURIComponent(this.getCode())),success:c.proxy(function(d){this.setCode(d);this.syncCode()},this)})},observeImages:function(){if(c.browser.mozilla){this.doc.execCommand("enableObjectResizing",false,"false")}c(this.doc).find("img").attr("unselectable","on").each(c.proxy(function(d,e){this.resizeImage(e)},this))},observeScroll:function(){var d=c(document).scrollTop();var e=this.$box.offset().top;if(d>e){this.fixed=true;this.$toolbar.css({position:"fixed",width:"100%"})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto"})}},observeAutoResize:function(){this.$editor.css({"min-height":this.$el.height()+"px"});c(this.doc).find("body").css({overflow:"hidden"});this.setAutoSize(false);c(this.doc).keyup(c.proxy(this.setAutoSize,this))},setAutoSize:function(f){var d=false;if(f!==false){d=f.keyCode||f.which}if(f==false||d==13){this.$frame.height(this.$editor.outerHeight(true)+30)}else{if(d==8||d==46){this.$frame.height(this.$editor.outerHeight(true))}}},execCommand:function(d,g){if(this.opts.visual&&this.doc){try{if(c.browser.msie){this.focus()}if(d=="inserthtml"&&c.browser.msie){this.doc.selection.createRange().pasteHTML(g)}else{if(d=="formatblock"&&c.browser.msie){this.doc.execCommand(d,false,"<"+g+">")}else{this.doc.execCommand(d,false,g)}}this.syncCode();this.focus()}catch(f){}}},formatNewLine:function(f){var d=this.getParentNode();if(d.nodeName=="DIV"&&d.id=="page"){if(f.preventDefault){f.preventDefault()}element=c(this.getCurrentNode());if(element.get(0).tagName=="DIV"&&(element.html()==""||element.html()=="<br>")){newElement=c("<p>").append(element.clone().get(0).childNodes);element.replaceWith(newElement);newElement.html("<br />");this.setFocusNode(newElement.get(0));this.syncCode();return false}else{this.syncCode()}if(this.opts.convertLinks){this.$editor.linkify()}}else{this.syncCode();return true}},safariShiftKeyEnter:function(g,f){if(g.shiftKey&&f==13){g.preventDefault();var d=c("<span><br /></span>");this.insertNodeAtCaret(d.get(0));this.setFocusNode(d.get(0));this.syncCode();return false}else{return true}},formatEmpty:function(h){var f=c.trim(this.$editor.html());if(c.browser.mozilla){f=f.replace(/<br>/gi,"")}if(f===""){if(h.preventDefault){h.preventDefault()}var d=this.opts.allEmptyHtml;if(c.browser.mozilla){d=this.opts.mozillaEmptyHtml}var g=c(d).get(0);this.$editor.html(g);this.setFocusNode(g);this.syncCode();return false}else{this.syncCode()}},paragraphy:function(f){f=c.trim(f);if(f===""){if(!c.browser.mozilla){return this.opts.allEmptyHtml}else{return this.opts.mozillaEmptyHtml}}if(this.opts.convertDivs){f=f.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}var g=function(i,j,h){return i.replace(new RegExp(j,"g"),h)};var d=function(i,h){return g(f,i,h)};var e="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";f+="\n";d("<br />\\s*<br />","\n\n");d("(<"+e+"[^>]*>)","\n$1");d("(</"+e+">)","$1\n\n");d("\r\n|\r","\n");d("\n\n+","\n\n");d("\n?((.|\n)+?)$","<p>$1</p>\n");d("<p>\\s*?</p>","");d("<p>(<div[^>]*>\\s*)","$1<p>");d("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");d("<p>\\s*(</?"+e+"[^>]*>)\\s*</p>","$1");d("<p>(<li.+?)</p>","$1");d("<p>\\s*(</?"+e+"[^>]*>)","$1");d("(</?"+e+"[^>]*>)\\s*</p>","$1");d("(</?"+e+"[^>]*>)\\s*<br />","$1");d("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");if(f.indexOf("<pre")!=-1){d("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(k,j,i,h){return g(j,"\\\\(['\"\\\\])","$1")+g(g(g(h,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"})}return d("\n</p>$","</p>")},preformater:function(d){d=d.replace(/<br>/gi,"<br />");d=d.replace(/<blockquote\b[^>]*>([\w\W]*?)<p>([\w\W]*?)<\/p>([\w\W]*?)<\/blockquote[^>]*>/gi,"<blockquote>$1$2<br />$3</blockquote>");d=d.replace(/<strong\b[^>]*>([\w\W]*?)<\/strong[^>]*>/gi,"<b>$1</b>");d=d.replace(/<em\b[^>]*>([\w\W]*?)<\/em[^>]*>/gi,"<i>$1</i>");d=d.replace(/<del\b[^>]*>([\w\W]*?)<\/del[^>]*>/gi,"<strike>$1</strike>");return d},reformater:function(d){d=d.replace(/<br>/gi,"<br />");d=d.replace(/<b\b[^>]*>([\w\W]*?)<\/b[^>]*>/gi,"<strong>$1</strong>");d=d.replace(/<i\b[^>]*>([\w\W]*?)<\/i[^>]*>/gi,"<em>$1</em>");d=d.replace(/<strike\b[^>]*>([\w\W]*?)<\/strike[^>]*>/gi,"<del>$1</del>");d=d.replace(/<span(.*?)style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong>$2</strong>");d=d.replace(/<span(.*?)style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<em>$2</em>");d=d.replace(/<span(.*?)style="font-weight: bold; font-style: italic;">([\w\W]*?)<\/span>/gi,"<em><strong>$2</strong></em>");d=d.replace(/<span(.*?)style="font-style: italic; font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong><em>$2</em></strong>");return d},cleanUpClasses:function(d){d=d.replace(/\s*class="TOC(.*?)"/gi,"");d=d.replace(/\s*class="Heading(.*?)"/gi,"");d=d.replace(/\s*class="Body(.*?)"/gi,"");return d},cleanUpStyles:function(d){d=d.replace(/\s*mso-[^:]+:[^;"]+;?/gi,"");d=d.replace(/\s*margin(.*?)pt\s*;/gi,"");d=d.replace(/\s*margin(.*?)cm\s*;/gi,"");d=d.replace(/\s*text-indent:(.*?)\s*;/gi,"");d=d.replace(/\s*line-height:(.*?)\s*;/gi,"");d=d.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"');d=d.replace(/\s*font-variant: [^\s;]+;?"/gi,'"');d=d.replace(/\s*tab-stops:[^;"]*;?/gi,"");d=d.replace(/\s*tab-stops:[^"]*/gi,"");d=d.replace(/\s*face="[^"]*"/gi,"");d=d.replace(/\s*face=[^ >]*/gi,"");d=d.replace(/\s*font:(.*?);/gi,"");d=d.replace(/\s*font-size:(.*?);/gi,"");d=d.replace(/\s*font-weight:(.*?);/gi,"");d=d.replace(/\s*font-family:[^;"]*;?/gi,"");d=d.replace(/<span style="Times New Roman&quot;">\s\n<\/span>/gi,"");return d},cleanUp:function(d){d=d.replace(/(<\!\-\-([\w\W]*?)\-\->)/ig,"");if(this.opts.convertDivs){d=d.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")}d=d.replace(/ lang="([\w\W]*?)"/gi,"");d=d.replace(/<a name="(.*?)">([\w\W]*?)<\/a>/gi,"");d=d.replace(/\&nbsp;\&nbsp;\&nbsp;/gi," ");d=d.replace(/\&nbsp;\&nbsp;/gi," ");d=d.replace(/<o:p>(.*?)<\/o:p>/gi,"");d=d.replace(/\s*style="\s*"/gi,"");d=d.replace(/<span>&nbsp;<\/span>/gi,"");d=d.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");return d},removeTags:function(d){return d.replace(/<(?!\s*\/?(code|span|div|label|a|br|p|b|i|del|strike|img|video|audio|iframe|object|embed|param|blockquote|mark|cite|small|ul|ol|li|hr|dl|dt|dd|sup|sub|big|pre|code|figure|figcaption|strong|em|table|tr|td|th|tbody|thead|tfoot|h1|h2|h3|h4|h5|h6)\b)[^>]+>/gi,"")},pasteCleanUp:function(d){var e=this.$editor.html();e=this.formating(e);e=this.cleanUp(e);if(this.opts.removeClasses){e=e.replace(/ class="([\w\W]*?)"/gi,"")}else{e=this.cleanUpClasses(e)}if(this.opts.removeStyles){e=e.replace(/ style="([\w\W]*?)"/gi,"")}else{e=this.cleanUpStyles(e)}e=this.cleanUp(e);e=this.formating(e);e=e.replace(/<b(.*?)id="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$3");this.$editor.html(e);var f=c(this.doc.body).find("#pastemarkerend"+d).get(0);this.setFocusNode(f);c(this.doc.body).find("span[rel=pastemarkerend]").not("#pastemarkerend"+d).remove();this.syncCode();this.observeImages()},formating:function(k){if(c.browser.msie){k=k.replace(/<*(\/ *)?(\w+)>/g,function(i){return i.toLowerCase()});k=k.replace(/style="(.*?)"/g,function(i){return i.toLowerCase()});k=k.replace(/ jQuery(.*?)=\"(.*?)\"/gi,"")}k=k.replace(/<font([\w\W]*?)color="(.*?)">([\w\W]*?)<\/font\>/gi,'<span style="color: $2;">$3</span>');k=k.replace(/<font([\w\W]*?)>([\w\W]*?)<\/font\>/gi,"<span$1>$2</span>");k=k.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");k=k.replace(/ class="Apple-style-span"/gi,"");k=k.replace(/ class="Apple-tab-span"/gi,"");k=k.replace(/<p><p>/g,"<p>");k=k.replace(/<\/p><\/p>/g,"</p>");k=k.replace(/<hr(.*?)>/g,"<hr />");k=k.replace(/<p>&nbsp;/g,"<p>");k=k.replace(/<p><ul>/g,"<ul>");k=k.replace(/<p><ol>/g,"<ol>");k=k.replace(/<\/ul><\/p>/g,"</ul>");k=k.replace(/<\/ol><\/p>/g,"</ol>");k=k.replace(/<p(.*?)>&nbsp;<\/p>/gi,"");k=k.replace(/[\t]*/g,"");k=k.replace(/\n\s*\n/g,"\n");k=k.replace(/^[\s\n]*/,"");k=k.replace(/[\s\n]*$/,"");var f=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<b>\\s*</b>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var g=0;g<f.length;++g){var m=f[g];k=k.replace(new RegExp(m,"gi"),"")}var e="\r\n";var j=["<form","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var g=0;g<j.length;++g){var h=j[g];k=k.replace(new RegExp(h,"gi"),e+h)}var l=["</p>","</div>","</ul>","</ol>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var g=0;g<l.length;++g){var d=l[g];k=k.replace(new RegExp(d,"gi"),d+e)}k=k.replace(/<li/g,"\t<li");k=k.replace(/<tr/g,"\t<tr");k=k.replace(/<td/g,"\t\t<td");k=k.replace(/<\/tr>/g,"\t</tr>");return k},toggle:function(){var d;if(this.opts.visual){this.$frame.hide();d=this.$editor.html();d=c.trim(this.formating(d));this.$el.val(d).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();this.$editor.html(this.$el.val());this.$frame.show();if(this.$editor.html()===""){if(!c.browser.mozilla){d=this.opts.allEmptyHtml}else{d=this.opts.mozillaEmptyHtml}this.setCode(d)}this.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages()}},autoSave:function(){if(this.opts.autosave===false){return false}setInterval(c.proxy(function(){c.post(this.opts.autosave,{data:this.getCode()})},this),this.opts.interval*1000)},buildToolbar:function(){if(this.opts.toolbar===false){return false}this.$toolbar=c("<ul>").addClass("redactor_toolbar");this.$box.prepend(this.$toolbar);c.each(RTOOLBAR[this.opts.toolbar],c.proxy(function(f,g){if(this.opts.fileUpload===false&&f=="file"){return true}var d=c("<li>");if(f=="fullscreen"){c(d).addClass("redactor_toolbar_right")}var e=this.buildButton(f,g);if(f=="backcolor"||f=="fontcolor"||typeof(g.dropdown)!="undefined"){var h=c('<div class="redactor_dropdown" style="display: none;">');if(f=="backcolor"||f=="fontcolor"){h=this.buildColorPicker(h,f)}else{h=this.buildDropdown(h,g.dropdown)}this.dropdowns.push(h.appendTo(c(document.body)));this.hdlHideDropDown=c.proxy(function(i){this.hideDropDown(i,h,f)},this);this.hdlShowDropDown=c.proxy(function(i){this.showDropDown(i,h,f)},this);e.click(this.hdlShowDropDown)}this.$toolbar.append(c(d).append(e));if(typeof(g.separator)!="undefined"){this.$toolbar.append(c('<li class="redactor_separator"></li>'))}},this));c(document).click(this.hdlHideDropDown);c(this.doc).click(this.hdlHideDropDown)},buildButton:function(e,f){var d=c('<a href="javascript:void(null);" title="'+f.title+'" class="redactor_btn_'+e+'"><span>&nbsp;</span></a>');if(typeof(f.func)=="undefined"){d.click(c.proxy(function(){this.execCommand(f.exec,e)},this))}else{if(f.func!="show"){d.click(c.proxy(function(g){this[f.func](g)},this))}}return d},buildDropdown:function(e,d){c.each(d,c.proxy(function(f,h){if(typeof(h.style)=="undefined"){h.style=""}var g;if(h.name=="separator"){g=c('<a class="redactor_separator_drop">')}else{g=c('<a href="javascript:void(null);" style="'+h.style+'">'+h.title+"</a>");if(typeof(h.func)=="undefined"){c(g).click(c.proxy(function(){this.execCommand(h.exec,f)},this))}else{c(g).click(c.proxy(function(i){this[h.func](i)},this))}}c(e).append(g)},this));return e},buildColorPicker:function(m,l){var g;if(l=="backcolor"){if(c.browser.msie){g="BackColor"}else{g="hilitecolor"}}else{g="forecolor"}c(m).width(210);var h=this.opts.colors.length;for(var f=0;f<h;++f){var d=this.opts.colors[f];var k=c('<a rel="'+d+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:d});c(m).append(k);var j=this;c(k).click(function(){if(c.browser.mozilla){j.execCommand("useCSS",false,false);j.execCommand(g,c(this).attr("rel"));j.execCommand("useCSS",false,true)}else{j.execCommand(g,c(this).attr("rel"))}})}var e=c('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);if(l=="backcolor"){e.click(c.proxy(this.setBackgroundNone,this))}else{e.click(c.proxy(this.setColorNone,this))}c(m).append(e);return m},setBackgroundNone:function(){c(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){c(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(h,i,d){this.hideAllDropDown();this.setBtnActive(d);this.getBtn(d).addClass("dropact");var g=this.getBtn(d).offset().left;if(this.opts.fixed&&this.fixed){c(i).css({position:"fixed",left:g+"px",top:"30px"}).show()}else{var f=this.$toolbar.offset().top+30;c(i).css({position:"absolute",left:g+"px",top:f+"px"}).show()}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact");c(".redactor_dropdown").hide()},hideDropDown:function(f,g,d){if(!c(f.target).parent().hasClass("dropact")){c(g).removeClass("act");this.showedDropDown=false;this.hideAllDropDown()}},getSelection:function(){if(this.$frame.get(0).contentWindow.getSelection){return this.$frame.get(0).contentWindow.getSelection()}else{if(this.$frame.get(0).contentWindow.document.selection){return this.$frame.get(0).contentWindow.document.selection.createRange()}}},getParentNode:function(){if(window.getSelection){return this.getSelection().getRangeAt(0).startContainer.parentNode}else{if(document.selection){return this.getSelection().parentElement()}}},getCurrentNode:function(){if(window.getSelection){return this.getSelection().getRangeAt(0).startContainer}else{if(document.selection){return this.getSelection()}}},setFocusNode:function(g,e){var d=this.doc.createRange();var f=this.getSelection();e=e?0:1;if(f!==null){d.selectNodeContents(g);f.addRange(d);f.collapse(g,e)}this.focus()},insertNodeAtCaret:function(h){if(typeof window.getSelection!="undefined"){var i=this.getSelection();if(i.rangeCount){var e=i.getRangeAt(0);e.collapse(false);e.insertNode(h);e=e.cloneRange();e.selectNodeContents(h);e.collapse(false);i.removeAllRanges();i.addRange(e)}}else{if(typeof document.selection!="undefined"&&document.selection.type!="Control"){var f=(h.nodeType==1)?h.outerHTML:h.data;var j="marker_"+(""+Math.random()).slice(2);f+='<span id="'+j+'"></span>';var g=this.getSelection();g.collapse(false);g.pasteHTML(f);var d=document.getElementById(j);g.moveToElementText(d);g.select();d.parentNode.removeChild(d)}}},getBtn:function(d){return c(this.$toolbar.find("a.redactor_btn_"+d))},setBtnActive:function(d){this.getBtn(d).addClass("act")},setBtnInactive:function(d){this.getBtn(d).removeClass("act")},changeBtnIcon:function(d,e){this.getBtn(d).addClass("redactor_btn_"+e)},removeBtnIcon:function(d,e){this.getBtn(d).removeClass("redactor_btn_"+e)},removeBtn:function(d){this.getBtn(d).remove()},addBtn:function(d,e){this.$toolbar.append(c("<li>").append(this.buildButton(d,e)))},fullscreen:function(){var d;if(this.opts.fullscreen===false){this.changeBtnIcon("fullscreen","normalscreen");this.setBtnActive("fullscreen");this.opts.fullscreen=true;this.height=this.$frame.css("height");this.width=(this.$box.width()-2)+"px";d=this.getCode();this.tmpspan=c("<span></span>");this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan);c(document.body).prepend(this.$box).css("overflow","hidden");this.$editor=this.enable(d);c(this.doc).click(c.proxy(this.hideAllDropDown,this));c(this.doc).click(c.proxy(function(f){this.$editor.focus()},this));this.observeImages();this.$box.find(".redactor_resizer").hide();this.fullScreenResize();c(window).resize(c.proxy(this.fullScreenResize,this));c(document).scrollTop(0,0);this.focus()}else{this.removeBtnIcon("fullscreen","normalscreen");this.setBtnInactive("fullscreen");this.opts.fullscreen=false;c(window).unbind("resize",c.proxy(this.fullScreenResize,this));c(document.body).css("overflow","");d=this.getCode();this.$box.removeClass("redactor_box_fullscreen").css("width","auto");this.tmpspan.after(this.$box).remove();this.$editor=this.enable(d);this.observeImages();if(this.opts.autoresize){this.observeAutoResize()}this.$box.find(".redactor_resizer").show();c(this.doc).click(c.proxy(this.hideAllDropDown,this));c(this.doc).click(c.proxy(function(f){this.$editor.focus()},this));this.syncCode();this.$frame.css("height",this.height);this.$el.css("height",this.height);this.focus()}},fullScreenResize:function(){if(this.opts.fullscreen===false){return}var e=42;if(this.opts.air){e=2}var d=c(window).height()-e;this.$box.width(c(window).width()-2);this.$frame.height(d);this.$el.height(d)},buildResizer:function(){if(this.opts.resize===false){return false}this.$resizer=c('<div class="redactor_resizer">&mdash;</div>');this.$box.append(this.$resizer);this.$resizer.mousedown(c.proxy(this.initResize,this))},initResize:function(d){if(d.preventDefault){d.preventDefault()}this.splitter=d.target;if(this.opts.visual){this.element_resize=this.$frame;this.element_resize.get(0).style.visibility="hidden";this.element_resize_parent=this.$el}else{this.element_resize=this.$el;this.element_resize_parent=this.$frame}this.stopResizeHdl=c.proxy(this.stopResize,this);this.startResizeHdl=c.proxy(this.startResize,this);this.resizeHdl=c.proxy(this.resize,this);c(document).mousedown(this.startResizeHdl);c(document).mouseup(this.stopResizeHdl);c(this.splitter).mouseup(this.stopResizeHdl);this.null_point=false;this.h_new=false;this.h=this.element_resize.height()},startResize:function(){c(document).mousemove(this.resizeHdl)},resize:function(f){if(f.preventDefault){f.preventDefault()}var g=f.pageY;if(this.null_point===false){this.null_point=g}if(this.h_new===false){this.h_new=this.element_resize.height()}var d=(this.h_new+g-this.null_point)-10;if(d<=30){return true}if(d>=0){this.element_resize.get(0).style.height=d+"px";this.element_resize_parent.get(0).style.height=d+"px"}},stopResize:function(d){c(document).unbind("mousemove",this.resizeHdl);c(document).unbind("mousedown",this.startResizeHdl);c(document).unbind("mouseup",this.stopResizeHdl);c(this.splitter).unbind("mouseup",this.stopResizeHdl);this.element_resize.get(0).style.visibility="visible"},resizeImage:function(e){var h=false;var d=false;var m;var l;var g=c(e).width()/c(e).height();var i=1;var j=1;var k=1;var f=1;c(e).hover(function(){c(e).css("cursor","nw-resize")},function(){c(e).css("cursor","default");h=false});c(e).mousedown(function(n){if(n.preventDefault){n.preventDefault()}h=true;d=true;m=Math.round(n.pageX-c(e).eq(0).offset().left);l=Math.round(n.pageY-c(e).eq(0).offset().top)});c(e).mouseup(c.proxy(function(n){h=false;this.syncCode()},this));c(e).click(c.proxy(function(n){if(d){this.imageEdit(n)}},this));c(e).mousemove(function(r){if(h){d=false;var o=Math.round(r.pageX-c(this).eq(0).offset().left)-m;var n=Math.round(r.pageY-c(this).eq(0).offset().top)-l;var q=c(e).height();var s=parseInt(q)+n;var p=s*g;if(j==1||(typeof(j)=="number"&&p<j&&p>k)){c(e).width(p)}if(i==1||(typeof(i)=="number"&&s<i&&s>f)){c(e).height(s)}m=Math.round(r.pageX-c(this).eq(0).offset().left);l=Math.round(r.pageY-c(this).eq(0).offset().top)}})},showTable:function(){this.modalInit(RLANG.table,"table",300,c.proxy(function(){c("#redactor_table_rows").focus();c("#redactor_insert_table_btn").click(c.proxy(this.insertTable,this))},this))},insertTable:function(){var n=c("#redactor_table_rows").val();var g=c("#redactor_table_columns").val();var d=c("<div></div>");var e=Math.floor(Math.random()*99999);var l=c('<table id="table'+e+'"><tbody></tbody></table>');for(var h=0;h<n;h++){var m=c("<tr></tr>");for(var k=0;k<g;k++){var f=c("<td>&nbsp;</td>");c(m).append(f)}c(l).append(m)}c(d).append(l);var j=c(d).html();if(c.browser.msie){j+="<p></p>"}else{j+="<p>&nbsp;</p>"}this.execCommand("inserthtml",j);this.modalClose();this.$table=c(this.doc).find("body").find("#table"+e);this.$table.click(c.proxy(this.tableObserver,this))},tableObserver:function(d){this.$table=c(d.target).parents("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$table_td.removeClass("current");this.$tbody=c(d.target).parents("tbody");this.$thead=c(this.$table).find("thead");this.$current_td=c(d.target);this.$current_td.addClass("current");this.$current_tr=c(d.target).parents("tr")},deleteTable:function(){c(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){c(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var d=c(this.$current_td).get(0).cellIndex;c(this.$table).find("tr").each(function(){c(this).find("td").eq(d).remove()});this.syncCode()},addHead:function(){if(c(this.$table).find("thead").size()!==0){this.deleteHead()}else{var d=c(this.$table).find("tr").first().clone();d.find("td").html("&nbsp;");this.$thead=c("<thead></thead>");this.$thead.append(d);c(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){c(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(d){var e=c(this.$current_tr).clone();e.find("td").html("&nbsp;");if(d=="after"){c(this.$current_tr).after(e)}else{c(this.$current_tr).before(e)}this.syncCode()},insertColumn:function(e){var d=0;this.$current_td.addClass("current");this.$current_tr.find("td").each(function(f,g){if(c(g).hasClass("current")){d=f}});this.$table_tr.each(function(f,g){var h=c(g).find("td").eq(d);var j=h.clone();j.html("&nbsp;");if(e=="after"){c(h).after(j)}else{c(h).before(j)}});this.syncCode()},showVideo:function(){if(c.browser.msie){this.markerIE()}this.modalInit(RLANG.video,"video",600,c.proxy(function(){c("#redactor_insert_video_area").focus();c("#redactor_insert_video_btn").click(c.proxy(this.insertVideo,this))},this))},insertVideo:function(){var d=c("#redactor_insert_video_area").val();d=this.removeTags(d);if(c.browser.msie){c(this.doc.getElementById("span"+this.spanid)).after(d).remove();this.syncCode()}else{this.execCommand("inserthtml",d)}this.modalClose()},imageEdit:function(h){var d=c(h.target);var g=d.parent();var f=c.proxy(function(){c("#redactor_file_alt").val(d.attr("alt"));c("#redactor_image_edit_src").attr("href",d.attr("src"));c("#redactor_form_image_align").val(d.css("float"));if(c(g).get(0).tagName=="A"){c("#redactor_file_link").val(c(g).attr("href"))}c("#redactor_image_delete_btn").click(c.proxy(function(){this.imageDelete(d)},this));c("#redactorSaveBtn").click(c.proxy(function(){this.imageSave(d)},this))},this);this.modalInit(RLANG.image,"image_edit",380,f)},imageDelete:function(d){c(d).remove();this.modalClose();this.syncCode()},imageSave:function(e){var d=c(e).parent();c(e).attr("alt",c("#redactor_file_alt").val());var g=c("#redactor_form_image_align").val();if(g=="left"){c(e).css({"float":"left",margin:"0 10px 10px 0"})}else{if(g=="right"){c(e).css({"float":"right",margin:"0 0 10px 10px"})}else{c(e).css({"float":"none",margin:"0"})}}var f=c.trim(c("#redactor_file_link").val());if(f!==""){if(c(d).get(0).tagName!="A"){c(e).replaceWith('<a href="'+f+'">'+this.outerHTML(e)+"</a>")}else{c(d).attr("href",f)}}this.modalClose();this.observeImages();this.syncCode()},showImage:function(){if(c.browser.msie){this.markerIE()}var d=c.proxy(function(){if(this.opts.imageGetJson!==false){c.getJSON(this.opts.imageGetJson,c.proxy(function(f){c.each(f,c.proxy(function(h,i){var g=c('<img src="'+i.thumb+'" rel="'+i.image+'" />');c("#redactor_image_box").append(g);c(g).click(c.proxy(this.imageSetThumb,this))},this))},this))}else{c("#redactor_tabs a").eq(1).remove()}if(this.opts.imageUpload!==false){if(c("#redactor_file").size()!==0){c("#redactor_file").dragupload({url:this.opts.imageUpload,success:c.proxy(this.imageUploadCallback,this)})}this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:c.proxy(this.imageUploadCallback,this)})}else{c(".redactor_tab").hide();if(this.opts.imageGetJson===false){c("#redactor_tabs").remove();c("#redactor_tab3").show()}else{var e=c("#redactor_tabs a");e.eq(0).remove();e.eq(1).addClass("redactor_tabs_act");c("#redactor_tab2").show()}}c("#redactor_upload_btn").click(c.proxy(this.imageUploadCallbackLink,this))},this);this.modalInit(RLANG.image,"image",570,d,true)},imageSetThumb:function(d){this._imageSet('<img alt="" src="'+c(d.target).attr("rel")+'" />',true)},imageUploadCallbackLink:function(){if(c("#redactor_file_link").val()!==""){var d='<img src="'+c("#redactor_file_link").val()+'" />';this._imageSet(d,true)}else{this.modalClose()}},imageUploadCallback:function(d){this._imageSet(d)},_imageSet:function(e,f){if(f!==true){var g=c.parseJSON(e);var d='<p><img src="'+g.filelink+'" /></p>'}else{var d=e}this.focus();if(c.browser.msie){c(this.doc.getElementById("span"+this.spanid)).after(d).remove();this.syncCode()}else{this.execCommand("inserthtml",d)}if(f!==true&&typeof this.opts.imageUploadCallback=="function"){this.opts.imageUploadCallback(this,g)}this.modalClose();this.observeImages()},showLink:function(){var d=c.proxy(function(){var h=this.getSelection();if(c.browser.msie){var g=this.getParentNode();if(g.nodeName=="A"){this.insert_link_node=c(g);var i=this.insert_link_node.text();var e=this.insert_link_node.attr("href")}else{if(this.oldIE()){var i=h.text}else{var i=h.toString()}var e="";this.spanid=Math.floor(Math.random()*99999);var f='<span id="span'+this.spanid+'">'+i+"</span>";if(i!=""){f='<span id="span'+this.spanid+'">'+i+"</span>"}this.execCommand("inserthtml",f)}}else{if(h&&h.anchorNode&&h.anchorNode.parentNode.tagName=="A"){var e=h.anchorNode.parentNode.href;var i=h.anchorNode.parentNode.text;if(h.toString()===""){this.insert_link_node=h.anchorNode.parentNode}}else{var i=h.toString();var e=""}}c(".redactor_link_text").val(i);c("#redactor_link_url").val(e).focus();c("#redactor_insert_link_btn").click(c.proxy(this.insertLink,this))},this);this.modalInit(RLANG.link,"link",460,d)},insertLink:function(){var e=c("#redactor_tab_selected").val();var d="",f="";if(e==1){d=c("#redactor_link_url").val();f=c("#redactor_link_url_text").val()}else{if(e==2){d="mailto:"+c("#redactor_link_mailto").val();f=c("#redactor_link_mailto_text").val()}else{if(e==3){d="#"+c("#redactor_link_anchor").val();f=c("#redactor_link_anchor_text").val()}}}this._insertLink('<a href="'+d+'">'+f+"</a> ",c.trim(f),d)},_insertLink:function(d,f,e){if(f!=""){if(this.insert_link_node){c(this.insert_link_node).text(f);c(this.insert_link_node).attr("href",e);this.syncCode()}else{if(c.browser.msie){c(this.doc.getElementById("span"+this.spanid)).replaceWith(d);this.syncCode()}else{this.execCommand("inserthtml",d)}}}this.modalClose()},showFile:function(){if(c.browser.msie){this.markerIE()}var d=c.proxy(function(){var e=this.getSelection();var f="";if(this.oldIE()){f=e.text}else{f=e.toString()}c("#redactor_filename").val(f);c("#redactor_file").dragupload({url:this.opts.fileUpload,success:c.proxy(function(g){this.fileUploadCallback(g)},this)});this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,success:c.proxy(function(g){this.fileUploadCallback(g)},this)})},this);this.modalInit(RLANG.file,"file",500,d)},fileUploadCallback:function(d){var f=c.parseJSON(d);var g=c("#redactor_filename").val();if(g==""){g=f.filename}var e='<a href="'+f.filelink+'">'+g+"</a>";if(c.browser.webkit&&!!window.chrome){e=e+"&nbsp;"}if(c.browser.msie){if(g!=""){c(this.doc.getElementById("span"+this.spanid)).replaceWith(a)}else{c(this.doc.getElementById("span"+this.spanid)).after(e).remove()}this.syncCode()}else{this.execCommand("inserthtml",e)}if(typeof this.opts.fileUploadCallback=="function"){this.opts.fileUploadCallback(this,f)}this.modalClose()},setupModalWindows:function(){this.opts.modal={file:'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',image_edit:"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" />&nbsp;&nbsp;<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",image:'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">		<div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div>		<div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;">		<label>'+RLANG.image_web_link+'</lable><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />		<div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" />&nbsp;&nbsp;<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",link:'<form id="redactorInsertLinkForm" method="post" action="">	<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div>	<input type="hidden" id="redactor_tab_selected" value="1" />	<div class="redactor_tab" id="redactor_tab1">		<label>URL</label><input id="redactor_link_url" class="redactor_input"  />		<label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" />	</div>	<div class="redactor_tab" id="redactor_tab2" style="display: none;">		<label>Email</label><input id="redactor_link_mailto" class="redactor_input" />		<label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />	</div>	<div class="redactor_tab" id="redactor_tab3" style="display: none;">		<label>'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  />		<label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />	</div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" />&nbsp;&nbsp;<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",table:"<label>"+RLANG.Rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.Columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" />&nbsp;&nbsp;<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",video:'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" />&nbsp;&nbsp;<a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>"}},modalInit:function(i,f,h,g,e){if(c("#redactor_modal_overlay").size()==0){this.overlay=c('<div id="redactor_modal_overlay" style="display: none;"></div>');c("body").prepend(this.overlay)}if(this.opts.overlay){c("#redactor_modal_overlay").show();c("#redactor_modal_overlay").click(c.proxy(this.modalClose,this))}if(c("#redactor_modal").size()==0){this.modal=c('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');c("body").append(this.modal)}c("#redactor_modal_close").click(c.proxy(this.modalClose,this));this.hdlModalClose=c.proxy(function(j){if(j.keyCode==27){this.modalClose()}},this);c(document).keyup(this.hdlModalClose);c(this.doc).keyup(this.hdlModalClose);c("#redactor_modal_inner").html(this.opts.modal[f]);c("#redactor_modal_header").html(i);if(c("#redactor_tabs").size()!=0){c("#redactor_tabs a").each(function(j,k){j++;c(k).click(function(){c("#redactor_tabs a").removeClass("redactor_tabs_act");c(this).addClass("redactor_tabs_act");c(".redactor_tab").hide();c("#redactor_tab"+j).show();c("#redactor_tab_selected").val(j);var l=c("#redactor_modal").outerHeight();c("#redactor_modal").css("margin-top","-"+(l+10)/2+"px")})})}c("#redactor_btn_modal_close").click(c.proxy(this.modalClose,this));if(typeof(g)=="function"){g()}var d=c("#redactor_modal").outerHeight();c("#redactor_modal").css({width:h+"px",height:"auto",marginTop:"-"+(d+10)/2+"px",marginLeft:"-"+(h+60)/2+"px"}).fadeIn("fast");if(e===true){c("#redactor_image_box").height(300).css("overflow","auto")}},modalClose:function(){c("#redactor_modal_close").unbind("click",this.modalClose);c("#redactor_modal").fadeOut("fast",c.proxy(function(){c("#redactor_modal_inner").html("");if(this.opts.overlay){c("#redactor_modal_overlay").hide();c("#redactor_modal_overlay").unbind("click",this.modalClose)}c(document).unbind("keyup",this.hdlModalClose);c(this.doc).unbind("keyup",this.hdlModalClose)},this))},uploadInit:function(e,d){this.uploadOptions={url:false,success:false,start:false,trigger:false,auto:false,input:false};c.extend(this.uploadOptions,d);if(c("#"+e).size()!=0&&c("#"+e).get(0).tagName=="INPUT"){this.uploadOptions.input=c("#"+e);this.element=c(c("#"+e).get(0).form)}else{this.element=c("#"+e)}this.element_action=this.element.attr("action");if(this.uploadOptions.auto){c(this.uploadOptions.input).change(c.proxy(function(){this.element.submit(function(f){return false});this.uploadSubmit()},this))}else{if(this.uploadOptions.trigger){c("#"+this.uploadOptions.trigger).click(c.proxy(this.uploadSubmit,this))}}},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var f=document.createElement("div");var e='<iframe style="display:none" src="about:blank" id="'+this.id+'" name="'+this.id+'"></iframe>';f.innerHTML=e;document.body.appendChild(f);if(this.uploadOptions.start){this.uploadOptions.start()}c("#"+this.id).load(c.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(h,g){if(this.uploadOptions.input){var i="redactorUploadForm"+this.id;var d="redactorUploadFile"+this.id;this.form=c('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+g+'" name="'+i+'" id="'+i+'" enctype="multipart/form-data"></form>');var e=this.uploadOptions.input;var j=c(e).clone();c(e).attr("id",d);c(e).before(j);c(e).appendTo(this.form);c(this.form).css("position","absolute");c(this.form).css("top","-2000px");c(this.form).css("left","-2000px");c(this.form).appendTo("body");this.form.submit()}else{h.attr("target",g);h.attr("method","POST");h.attr("enctype","multipart/form-data");h.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var e=c("#"+this.id);if(e.contentDocument){var f=e.contentDocument}else{if(e.contentWindow){var f=e.contentWindow.document}else{var f=window.frames[this.id].document}}if(f.location.href=="about:blank"){return true}if(this.uploadOptions.success){this.uploadOptions.success(f.body.innerHTML)}this.element.attr("action",this.element_action);this.element.attr("target","")},markerIE:function(){this.spanid=Math.floor(Math.random()*99999);this.execCommand("inserthtml",'<span id="span'+this.spanid+'"></span>')},oldIE:function(){if(c.browser.msie&&parseInt(c.browser.version,10)<9){return true}return false},outerHTML:function(d){return c("<p>").append(c(d).eq(0).clone()).html()},normalize:function(d){return parseInt(d.replace("px",""))}};c.fn.getDoc=function(){return c(this.data("redactor").doc)};c.fn.getFrame=function(){return this.data("redactor").$frame};c.fn.getEditor=function(){return this.data("redactor").$editor};c.fn.getCode=function(){return this.data("redactor").getCode()};c.fn.setCode=function(d){this.data("redactor").setCode(d)};c.fn.insertHtml=function(d){this.data("redactor").insertHtml(d)};c.fn.destroyEditor=function(){this.data("redactor").destroy();this.removeData("redactor")};c.fn.setFocus=function(){this.data("redactor").focus()};c.fn.execCommand=function(d,e){this.data("redactor").execCommand(d,e)}})(jQuery);(function(c){c.fn.dragupload=function(d){return this.each(function(){var e=new b(this,d);e.init()})};function b(e,d){this.opts=c.extend({url:false,success:false,preview:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},d);this.$el=c(e)}b.prototype={init:function(){if(!c.browser.opera&&!c.browser.msie){this.droparea=c('<div class="redactor_droparea"></div>');this.dropareabox=c('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=c('<div class="redactor_dropalternative">'+this.opts.atext+"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",c.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",c.proxy(function(){return this.ondragleave()},this));var f=c.proxy(function(h){var g=parseInt(h.loaded/h.total*100);this.dropareabox.text("Loading "+g+"%")},this);var e=jQuery.ajaxSettings.xhr();if(e.upload){e.upload.addEventListener("progress",f,false)}var d=function(){return e};this.dropareabox.get(0).ondrop=c.proxy(function(i){i.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var h=i.dataTransfer.files[0];var g=new FormData();g.append("file",h);c.ajax({dataType:"html",url:this.opts.url,data:g,xhr:d,cache:false,contentType:false,processData:false,type:"POST",success:c.proxy(function(j){if(this.opts.success!==false){this.opts.success(j)}if(this.opts.preview===true){this.dropareabox.html(j)}},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);(function(c){var e=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,b=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,d=function(){var h=this.childNodes,g=h.length;while(g--){var j=h[g];if(j.nodeType==3){var f=j.nodeValue;if(f){f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(e,'$1<a href="http://$2">$2</a>$3').replace(b,'$1<a href="$2">$2</a>$5');c(j).after(f).remove()}}else{if(j.nodeType==1&&!/^(a|button|textarea)$/i.test(j.tagName)){d.call(j)}}}};c.fn.linkify=function(){this.each(d)}})(jQuery);